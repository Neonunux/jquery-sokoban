<!DOCTYPE html>
<html lang="is">

<head>
  <meta charset=utf-8 />

  <title>Sōkoban: Microban levels</title>

  <link rel="stylesheet" media="screen" href="css/screen.css">
  <link rel="stylesheet" media="screen" href="css/sokoban.css">

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script> -->
  <script src="js/jquery.processEach.js"></script>
  <script src="js/jquery.sokoban.js"></script>

</head>

<body>
  <div id="top">

    <h1>
      <a href=".">Sokoban</a>: Microban levels</h1>

    <div id="info">
      <dl>
        <dt lang="jp">
          <strong>Sōkoban (倉庫番)</strong>
        </dt>
        <dd>(
          <abbr title="noun">n</abbr>) warehouseman; storekeeper</dd>
      </dl>
      <p>Sokoban was created in 1980 by
        <em>Hiroyuki Imabayashi</em>, and was published in 1982 by
        <em>Thinking Rabbit</em>, a software house based in Takarazuka, Japan.</p>
      <p>It spawned a genre of puzzle games, including the best selling
        <a href="http://en.wikipedia.org/wiki/Chip%27s_Challenge">Chips Challenge</a>,
        <i>Stone Age</i>, and many others, in addition to having been cloned and ported to almost all computer and operating
        systems in existance.</p>
      <hr>
    </div>

    <div id="instructions">
      <h2>How to play:</h2>
      <noscript>
        <p>You need JavaScript to play the game.</p>
      </noscript>
      <p>Move the
        <em>warehouseman</em> using the arrow keys and push all the boxes onto the colored part of the floor. Be careful not
        to get the boxes stuck in an unmovable position as they are to heavy to pull. If you make a mistake you can undo
        it with
        <em>control + z</em> or
        <em>backspace</em> and if you want to reset the level you can do so using
        <em>Escape</em>.</p>
      <hr>
    </div>

    <div id="levels">
      <pre>
; Microban levels
</pre>
      <hr>
      <pre class="sokoban level">
; 1

####
# .#
#  ###
#*@  #
#  $ #
#  ###
####
</pre>
      <hr>
    </div>

    <div id="footer">

      <hr>

      <p>This version of Sokoban was written by
        <a href="http://borgar.net">Borgar Þorsteinsson</a> one boring evening in 2009. It is licenced under the
        <a href="http://www.gnu.org/licenses/gpl-3.0.html" rel="licence">GNU General Public Licence v3.0</a>.</p>
    </div>

  </div>
  <script>
    jQuery(function () {

      var levels = $('pre.sokoban.level');

      levels
        .processEach(function () {
          $(this).sokoban();
        })
        .bind('keydown', function (e) {
          if (e.keyCode == 9) { // tab
            var i = (levels.length + (levels.index(this) + (e.shiftKey ? -1 : 1))) % levels.length;
            var o = levels.eq(i).find('.soko-room:first').focus();
            $(window).scrollTop(levels.eq(i).offset().top);
          }
        })
        .eq(0)
        .find('.soko-room:first')
        .focus()

      function wheelManager(event) {
        event.preventDefault()
        if (event.deltaY <= 0) {
          console.log('haut')
        } else {
          console.log('bas')
        }
      }

      function clickManager(event) {
        // console.log('click', event.clientX, event.clientY, event.x, event.y, event)

        // let docElem = document.documentElement,
        //   body = document.body,
        //   win = window,
        //   clientTop = docElem.clientTop || body.clientTop || 0,
        //   clientLeft = docElem.clientLeft || body.clientLeft || 0,
        //   scrollTop = win.pageYOffset || jQuery.support.boxModel && docElem.scrollTop || body.scrollTop,
        //   scrollLeft = win.pageXOffset || jQuery.support.boxModel && docElem.scrollLeft || body.scrollLeft,
        //   top = box.top + scrollTop - clientTop,
        //   left = box.left + scrollLeft - clientLeft;

        // console.log('click', top, left)
      }

      // document.getElementsByClassName('soko-room')[0].addEventListener('wheel', wheelManager);
      document.getElementsByClassName('soko-room')[0].addEventListener('click', clickManager);
    });
  </script>
</body>

</html>